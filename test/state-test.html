<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
    <script src="../../webcomponentsjs/webcomponents-loader.js"></script>
    <script src="../../web-component-tester/browser.js"></script>
    <link rel="import" href="../../app-pouchdb/pouchdb.html">
    <link rel="import" href="../request-editor.html">
  </head>
  <body>

    <test-fixture id="Basic">
      <template>
        <request-editor></request-editor>
      </template>
    </test-fixture>

    <script>
    suite('State computation', function() {
      let element;
      setup(function(done) {
        element = fixture('Basic');
        flush(() => done());
      });

      test('Computes default state', function() {
        const state = element.state;
        assert.typeOf(state, 'object', 'State is an object');
        assert.isTrue(state.collapseOpened, 'collapseOpened is true');
        assert.equal(state.selectedTab, 0, 'selectedTab is 0');
        assert.isUndefined(state.urlOpened, 'urlOpened is undefined');
      });

      test('Computes state for collapse', function() {
        element.toggle();
        const state = element.state;
        assert.typeOf(state, 'object', 'State is an object');
        assert.isFalse(state.collapseOpened, 'collapseOpened is false');
        assert.equal(state.selectedTab, 0, 'selectedTab is 0');
        assert.isUndefined(state.urlOpened, 'urlOpened is undefined');
      });

      test('Computes state for tab', function() {
        element.selectedTab = 2;
        const state = element.state;
        assert.typeOf(state, 'object', 'State is an object');
        assert.isTrue(state.collapseOpened, 'collapseOpened is true');
        assert.equal(state.selectedTab, 2, 'selectedTab is 2');
        assert.isUndefined(state.urlOpened, 'urlOpened is undefined');
      });

      test('Computes state for urlOpened', function() {
        const editor = element.shadowRoot.querySelector('url-input-editor');
        editor.detailsOpened = true;
        const state = element.state;
        assert.typeOf(state, 'object', 'State is an object');
        assert.isTrue(state.collapseOpened, 'collapseOpened is true');
        assert.equal(state.selectedTab, 0, 'selectedTab is 0');
        assert.isTrue(state.urlOpened, 'urlOpened is true');
      });
    });

    suite('State restoration', function() {
      let element;
      setup(function(done) {
        element = fixture('Basic');
        flush(() => done());
      });

      test('Restores collapse state', function() {
        element.state = {collapseOpened: false};
        assert.isFalse(element.collapseOpened);
      });

      test('Restores selected tab state', function() {
        element.state = {selectedTab: 2};
        assert.equal(element.selectedTab, 2);
      });

      test('Does not restores tab if it is body and no payload', function() {
        element.state = {selectedTab: 1};
        assert.equal(element.selectedTab, 0);
      });

      test('Does restore tab if it is body and payload', function() {
        element.method = 'POST';
        element.state = {selectedTab: 1};
        assert.equal(element.selectedTab, 1);
      });

      test('Restores url opened state', function() {
        element.state = {urlOpened: true};
        assert.isTrue(element.urlOpened);
      });
    });
    </script>
  </body>
</html>
